(function(R,S,T,I,U,C,l,K,L,M,V,W,N,X,Y,O,H,w,Z,P,$,aa,Q,ba,ca,da,ea,fa,ga,v,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,j,r){C("J.api");Q(J.api,"JmolPropertyManager");C("JV");K(["J.api.JmolPropertyManager","java.util.Hashtable"],"JV.PropertyManager","java.lang.Boolean $.Double $.Float java.util.Arrays $.Date $.Map JU.AU $.BArray $.BS $.Base64 $.Lst $.M3 $.M4 $.P3 $.PT $.SB $.V3 J.api.Interface JM.BondSet $.LabelToken JS.SV $.T JU.BSUtil $.C $.Edge $.Elements $.Escape $.JmolMolecule $.Logger JV.ActionManager $.JC $.Viewer JV.binding.Binding".split(" "),
function(){c$=M(function(){this.map=this.vwr=null;L(this,arguments)},JV,"PropertyManager",null,J.api.JmolPropertyManager);P(c$,function(){this.map=new java.util.Hashtable});N(c$,function(){});r(c$,"setViewer",function(a){this.vwr=a;for(var c=a=0;a<JV.PropertyManager.propertyTypes.length;a+=3)this.map.put(JV.PropertyManager.propertyTypes[a].toLowerCase(),Integer.$valueOf(c++))},"JV.Viewer");r(c$,"getPropertyNumber",function(a){a=this.map.get(null==a?"":a.toLowerCase());return null==a?-1:a.intValue()},
"~S");r(c$,"getDefaultPropertyParam",function(a){return 0>a?"":JV.PropertyManager.propertyTypes[3*a+2]},"~N");r(c$,"checkPropertyParameter",function(a){a=this.getPropertyNumber(a);a=JV.PropertyManager.getParamType(a);return 0<a.length&&"<atom selection>"!==a},"~S");r(c$,"getProperty",function(a,c,e){135!=JV.PropertyManager.propertyTypes.length&&JU.Logger.warn("propertyTypes is not the right length: "+JV.PropertyManager.propertyTypes.length+" != 135");if(0<=c.indexOf(".")||0<=c.indexOf("[")){var b=
this.getArguments(c);e=this.extractProperty(this.getPropertyAsObject(b[0].asString(),e,null),b,1,null,!1)}else e=this.getPropertyAsObject(c,e,a);if(null==a)return e;(b=a.equalsIgnoreCase("readable"))&&(a=JV.PropertyManager.isReadableAsString(c)?"String":"JSON");return a.equalsIgnoreCase("String")?null==e?"":e.toString():b?JU.Escape.toReadable(c,e):a.equalsIgnoreCase("JSON")?"{"+JU.PT.toJSON(c,e)+"}":e},"~S,~S,~O");j(c$,"getArguments",function(a){var c=a.toLowerCase(),e=-1;if(0<=a.indexOf('"')||0<=
a.indexOf("'"))a=this.fixSelectQuotes(a);for(;0<=(e=c.indexOf("[select ",++e));){var b=c.indexOf(" where ",e),d=c.lastIndexOf("]");0>b||b>d||(a=a.substring(0,e+1)+a.substring(e+1,d).$replace(".","\u0001").$replace("[","\u0002").$replace("]","\u0003")+a.substring(d))}a=JU.PT.rep(JU.PT.rep(a.$replace("]","\x00").$replace("[","\x00"),"..","\u0004").$replace(".","\x00").$replace("\u0001",".").$replace("\u0002","[").$replace("\u0003","]"),"\u0004","..");a=JU.PT.rep(a,"\x00\x00","\x00");a=JU.PT.split(JU.PT.trim(a,
"\x00"),"\x00");for(var c=Array(a.length),e=0,f;e<a.length;e++)c[e]=a[e].startsWith("'")||a[e].startsWith('"')?JS.SV.newS(JU.PT.trim(a[e],"'\"")):-2147483648==(f=JU.PT.parseInt(a[e]))?JS.SV.newS(a[e]):JS.SV.newI(f);return c},"~S");j(c$,"fixSelectQuotes",function(a){a=a.toCharArray();for(var c=!1,e=!1,b=!1,d=a.length;0<=--d;)switch(a[d]){case "'":b||(c=e=!c);break;case '"':e||(c=b=!c);break;case ".":c&&(a[d]="\u0001");break;case "[":c&&(a[d]="\u0002");break;case "]":c&&(a[d]="\u0003")}return a=String.instantialize(a)},
"~S");r(c$,"extractProperty",function(a,c,e,b,d){0>e&&(c=this.getArguments(c),e=0);if(e>=c.length)return a;d||(c=this.compileSelect(c));var f,g=c[e++];d=JS.SV.oValue(a);switch(g.tok){case 2:f=g.intValue-1;if(l(d,JU.Lst))return 0>f&&(f+=d.size()),0<=f&&f<d.size()?this.extractProperty(d.get(f),c,e,null,!0):"";if(l(d,JU.M3))return b=d,b=v(-1,[w(-1,[b.m00,b.m01,b.m02]),w(-1,[b.m10,b.m11,b.m12]),w(-1,[b.m20,b.m21,b.m22])]),0>f&&(f+=3),0<=f&&3>f?this.extractProperty(b,c,--e,null,!0):"";if(l(d,JU.M4))return b=
d,b=v(-1,[w(-1,[b.m00,b.m01,b.m02,b.m03]),w(-1,[b.m10,b.m11,b.m12,b.m13]),w(-1,[b.m20,b.m21,b.m22,b.m23]),w(-1,[b.m30,b.m31,b.m32,b.m33])]),0>f&&(f+=4),0<=f&&4>f?this.extractProperty(b,c,--e,null,!0):"";if(JU.AU.isAI(d))return 0>f&&(f+=d.length),0<=f&&f<d.length?Integer.$valueOf(d[f]):"";if(JU.AU.isAD(d))return 0>f&&(f+=d.length),0<=f&&f<d.length?Double.$valueOf(d[f]):"";if(JU.AU.isAF(d))return 0>f&&(f+=d.length),0<=f&&f<d.length?Float.$valueOf(d[f]):"";if(JU.AU.isAII(d)||JU.AU.isAFF(d))return 0>
f&&(f+=d.length),0<=f&&f<d.length?this.extractProperty(d[f],c,e,null,!0):"";if(JU.AU.isAS(d)||l(d,Array))return 0>f&&(f+=d.length),0<=f&&f<d.length?d[f]:"";break;case 135280133:case 4:if(l(d,java.util.Map)){var h=!1;if(135280133==g.tok)if(a=g.myName,a.equals("**")){a="";for(var n,q=d.entrySet().iterator();q.hasNext()&&((n=q.next())||1);)f=n.getKey(),h=n.getValue(),l(h,JS.SV)?h=h.getMap():l(h,java.util.Map)||(h=null),null!=h&&this.vwr.checkSelect(h,g.value)&&(a+=","+f);if(0==a.length)return"";h=!0}else{if(!this.vwr.checkSelect(d,
g.value))return""}else if(a=g.asString(),a.equalsIgnoreCase("keys")){b=new JU.Lst;for(d=d.keySet().iterator();d.hasNext()&&((f=d.next())||1);)b.addLast(f);return this.extractProperty(b,c,e,null,!0)}(f=a.startsWith("*")||a.endsWith("*")||0<=a.indexOf(","))&&null==b&&(b=new JU.Lst);if(f&&1==a.length)return e==c.length?(b.addLast(d),b):this.extractProperty(d,c,e,b,!0);if(a.contains(",")){h&&(a=a.substring(1));f=new java.util.Hashtable;a=JU.PT.split(a,",");for(n=a.length;0<=--n;)JV.PropertyManager.getMapSubset(d,
a[n],f);return h?f:e==c.length?(b.addLast(f),b):this.extractProperty(f,c,e,b,!0)}a=this.checkMap(d,a,f,b,c,e);return null!=a&&!f?this.extractProperty(d.get(a),c,e,null,!0):f?b:""}if(l(d,JU.Lst)){null==b&&(b=new JU.Lst);e--;for(f=0;f<d.size();f++)h=d.get(f),(l(h,java.util.Map)||l(h,JU.Lst)||l(h,JS.SV)&&(null!=h.getMap()||null!=h.getList()))&&this.extractProperty(h,c,e,b,!0);return b}}return a},"~O,~O,~N,JU.Lst,~B");c$.getMapSubset=j(c$,"getMapSubset",function(a,c,e){if(c.startsWith('"')||c.startsWith("'"))c=
JU.PT.trim(c,"\"'");var b=a.get(c);if(null!=b)e.put(c,b);else{var d;for(a=a.entrySet().iterator();a.hasNext()&&((d=a.next())||1);)b=d.getKey(),JU.PT.isLike(b,c)&&e.put(b,d.getValue())}},"java.util.Map,~S,java.util.Map");j(c$,"compileSelect",function(a){for(var c=null,e=a.length;0<=--e;)if(4==a[e].tok){var b=a[e].value;if(b.toUpperCase().startsWith("SELECT ")){null==c&&(c=JU.AU.arrayCopyObject(a,a.length));b=b.substring(6).trim();b.toUpperCase().startsWith("WHERE ")&&(b="* "+b);var d=b.toUpperCase().indexOf(" WHERE ");
0>d?c[e].value=b:(c[e]=JS.SV.newV(135280133,this.vwr.compileExpr(b.substring(d+6).trim())),c[e].myName=b.substring(0,d).trim())}}return null==c?a:c},"~A");j(c$,"checkMap",function(a,c,e,b,d,f){var g=null==b&&a.containsKey(c);if(!g)for(var h=e?c.toLowerCase():null,n,q=a.keySet().iterator();q.hasNext()&&((n=q.next())||1);)if(n.equalsIgnoreCase(c)||null!=h&&JU.PT.isLike(n.toLowerCase(),h)){if(null==b)return n;b.addLast(this.extractProperty(a.get(n),d,f,null,!0));if(!e)return null}return g?c:null},"java.util.Map,~S,~B,JU.Lst,~O,~N");
c$.getPropertyName=j(c$,"getPropertyName",function(a){return 0>a?"":JV.PropertyManager.propertyTypes[3*a]},"~N");c$.getParamType=j(c$,"getParamType",function(a){return 0>a?"":JV.PropertyManager.propertyTypes[3*a+1]},"~N");c$.isReadableAsString=j(c$,"isReadableAsString",function(a){for(var c=JV.PropertyManager.readableTypes.length;0<=--c;)if(a.equalsIgnoreCase(JV.PropertyManager.readableTypes[c]))return!0;return!1},"~S");j(c$,"getPropertyAsObject",function(a,c,e){if(a.equals("tokenList"))return JS.T.getTokensLike(c);
var b=this.getPropertyNumber(a),d=null!=c&&0<c.toString().length;c=d?c:this.getDefaultPropertyParam(b);switch(b){case 0:return this.getAppletInfo();case 5:return this.getAnimationInfo();case 13:return this.vwr.getAtomBitSetVector(c);case 14:return this.getAllAtomInfo(this.vwr.getAtomBitSet(c));case 24:return this.vwr.getAuxiliaryInfoForAtoms(c);case 15:return this.getAllBondInfo(c);case 25:return this.getBoundBoxInfo();case 10:return this.vwr.tm.fixedRotationCenter;case 16:return this.getAllChainInfo(this.vwr.getAtomBitSet(c));
case 37:return this.vwr.getProperty("DATA_API","consoleText",null);case 26:return this.vwr.getDataObj(c.toString(),null,-1);case 33:return this.vwr.getErrorMessageUn();case 28:return this.vwr.evaluateExpression(c.toString());case 20:return this.vwr.getModelExtract(c,!0,!1,"MOL");case 32:return JV.PropertyManager.getFileInfo(this.vwr.getFileData(),c.toString());case 1:return this.vwr.fm.getFullPathName(!1);case 2:return this.vwr.getFileHeader();case 4:case 3:return d?this.vwr.getFileAsString3(c.toString(),
!0,null):this.vwr.getCurrentFileAsString("prop");case 27:return a=c.toString().toLowerCase(),this.getImage(a,0>a.indexOf("g64")&&0>a.indexOf("base64")&&(null==e||e.equalsIgnoreCase("java")));case 35:return this.vwr.getShapeProperty(24,"getInfo");case 36:return this.vwr.getShapeProperty(24,"getData");case 40:return this.vwr.getNMRCalculation().getInfo(c.toString());case 41:return this.getVariables(c.toString());case 21:return this.vwr.getStatusChanged(c.toString());case 22:return this.vwr;case 38:return this.vwr.getJspecViewProperties(c);
case 7:return this.getLigandInfo(this.vwr.getAtomBitSet(c));case 9:return this.getMeasurementInfo();case 29:return this.vwr.getMenu(c.toString());case 23:return this.vwr.sm.messageQueue;case 30:return this.vwr.getMinimizationInfo();case 6:return this.getModelInfo(this.vwr.getAtomBitSet(c));case 18:return this.getMoleculeInfo(this.vwr.getAtomBitSet(c));case 34:return this.getMouseInfo();case 11:return this.vwr.tm.getOrientationInfo();case 31:return this.vwr.ms.getPointGroupInfo(this.vwr.getAtomBitSet(c));
case 17:return this.getAllPolymerInfo(this.vwr.getAtomBitSet(c));case 39:return this.vwr.getScriptQueueInfo();case 8:return this.getShapeInfo();case 19:return this.vwr.getStateInfo3(c.toString(),0,0);case 12:return JU.M3.newM3(this.vwr.tm.matrixRotate);case 42:return this.getAnnotationInfo(c,1073741925);case 43:return this.getAnnotationInfo(c,1073742189);case 44:return c=JS.SV.oValue(c),d=l(c,java.util.Map)?c:null,null==d?null:this.vwr.sm.processService(d)}e=Array(45);for(b=0;45>b;b++){d=JV.PropertyManager.getParamType(b);
c=this.getDefaultPropertyParam(b);var f=JV.PropertyManager.getPropertyName(b);e[b]="X"==f.charAt(0)?"":f+(""!==d?" "+JV.PropertyManager.getParamType(b)+(""!==c?" #default: "+this.getDefaultPropertyParam(b):""):"")}java.util.Arrays.sort(e);d=new JU.SB;d.append("getProperty ERROR\n").append(a).append("?\nOptions include:\n");for(b=0;45>b;b++)0<e[b].length&&d.append("\n getProperty ").append(e[b]);return d.toString()},"~S,~O,~S");j(c$,"getImage",function(a,c){var e=-1,b=-1,d;if(0<=(d=a.indexOf("height=")))e=
JU.PT.parseInt(a.substring(d+7));if(0<=(d=a.indexOf("width=")))b=JU.PT.parseInt(a.substring(d+6));0>b&&0>e?e=b=-1:0>b?b=e:e=b;var f="JPG";0<=a.indexOf("type=")&&(f=JU.PT.getTokens(JU.PT.replaceWithCharacter(a.substring(a.indexOf("type=")+5),";,"," "))[0]);d=Array(1);e=this.vwr.getImageAsBytes(f.toUpperCase(),b,e,-1,d);return null!=d[0]?d[0]:c?new JU.BArray(e):JU.Base64.getBase64(e).toString()},"~S,~B");j(c$,"getVariables",function(a){return a.toLowerCase().equals("all")?this.vwr.g.getAllVariables():
this.vwr.evaluateExpressionAsVariable(a)},"~S");c$.getFileInfo=j(c$,"getFileInfo",function(a,c){var e=new java.util.Hashtable;if(null==a)return e;var b=null!=c&&0<c.length;if(l(a,java.util.Map))return b?a.get(c):a;var d=JU.PT.split(a,"\n");if(0==d.length||6>d[0].length||" "!=d[0].charAt(6)||!d[0].substring(0,6).equals(d[0].substring(0,6).toUpperCase()))return e.put("fileHeader",a),e;var f="",g=new JU.SB;b&&(c=c.toUpperCase());for(var h="",n=0;n<d.length;n++){var q=d[n];if(!(12>q.length)){var h=q.substring(0,
6).trim(),k=q.substring(7,10).trim();h.equals("REMARK")&&(h+=k);if(!h.equals(f)){if(b&&f.equals(c))return g.toString();b||(e.put(f,g.toString()),g=new JU.SB);f=h}(!b||h.equals(c))&&g.append(q).appendC("\n")}}b||e.put(f,g.toString());return b?h.equals(c)?g.toString():"":e},"~O,~S");j(c$,"getMoleculeInfo",function(a){a=this.vwr.getAtomBitSet(a);for(var c=this.vwr.ms.getMolecules(),e=new JU.Lst,b=new JU.BS,d=0;d<c.length;d++){var b=JU.BSUtil.copy(a),f=c[d];b.and(f.atomList);0<b.length()&&(b=new java.util.Hashtable,
b.put("mf",f.getMolecularFormula(!1,null,!1)),b.put("number",Integer.$valueOf(f.moleculeIndex+1)),b.put("modelNumber",this.vwr.ms.getModelNumberDotted(f.modelIndex)),b.put("numberInModel",Integer.$valueOf(f.indexInModel+1)),b.put("nAtoms",Integer.$valueOf(f.ac)),b.put("nElements",Integer.$valueOf(f.nElements)),e.addLast(b))}return e},"~O");r(c$,"getModelInfo",function(a){a=this.vwr.ms.getModelBS(this.vwr.getAtomBitSet(a),!1);var c=this.vwr.ms,e=new java.util.Hashtable;e.put("modelSetName",c.modelSetName);
e.put("modelIndex",Integer.$valueOf(this.vwr.am.cmi));e.put("modelCount",Integer.$valueOf(c.mc));e.put("isTainted",Boolean.$valueOf(null!=c.tainted));e.put("canSkipLoad",Boolean.$valueOf(c.canSkipLoad));e.put("modelSetHasVibrationVectors",Boolean.$valueOf(c.modelSetHasVibrationVectors()));null!=c.modelSetProperties&&e.put("modelSetProperties",c.modelSetProperties);e.put("modelCountSelected",Integer.$valueOf(JU.BSUtil.cardinalityOf(a)));e.put("modelsSelected",a);var b=new JU.Lst;c.getMolecules();for(var d=
a.nextSetBit(0);0<=d;d=a.nextSetBit(d+1)){var f=new java.util.Hashtable;f.put("_ipt",Integer.$valueOf(d));f.put("num",Integer.$valueOf(c.getModelNumber(d)));f.put("file_model",c.getModelNumberDotted(d));f.put("name",c.getModelName(d));var g=c.getModelTitle(d);null!=g&&f.put("title",g);g=c.getModelFileName(d);null!=g&&f.put("file",g);g=c.getInfo(d,"modelID");null!=g&&f.put("id",g);f.put("vibrationVectors",Boolean.$valueOf(this.vwr.modelHasVibrationVectors(d)));g=c.am[d];f.put("atomCount",Integer.$valueOf(g.act));
f.put("bondCount",Integer.$valueOf(g.getBondCount()));f.put("groupCount",Integer.$valueOf(g.getGroupCount()));f.put("moleculeCount",Integer.$valueOf(g.moleculeCount));g.isBioModel&&f.put("polymerCount",Integer.$valueOf(g.getBioPolymerCount()));f.put("chainCount",Integer.$valueOf(c.getChainCountInModelWater(d,!0)));null!=g.properties&&f.put("modelProperties",g.properties);var h=c.getInfo(d,"Energy");null!=h&&f.put("energy",h);f.put("atomCount",Integer.$valueOf(g.act));b.addLast(f)}e.put("models",b);
return e},"~O");r(c$,"getLigandInfo",function(a){var c=this.vwr.getAtomBitSet(a),e=this.vwr.getAtomBitSet("solvent");a=new java.util.Hashtable;var b=new JU.Lst;a.put("ligands",b);var d=this.vwr.ms,f=JU.BSUtil.copyInvert(c,d.ac);f.or(e);for(var e=d.at,g=c.nextSetBit(0);0<=g;g=c.nextSetBit(g+1))(e[g].isProtein()||e[g].isNucleic())&&f.set(g);c=Array(d.mc);for(g=d.mc;0<=--g;)c[g]=this.vwr.getModelUndeletedAtomsBitSet(g),c[g].andNot(f);f=JU.JmolMolecule.getMolecules(e,c,null,f);for(g=0;g<f.length;g++){var c=
f[g].atomList,h=new java.util.Hashtable;b.addLast(h);h.put("atoms",JU.Escape.eBS(c));for(var n="",q="",k=null,D=0,m=null,j="",t="",p=2147483647,l=2147483647,u=c.nextSetBit(0);0<=u;u=c.nextSetBit(u+1)){var s=e[u];if(k!==s.group){var k=s.group,r=s.getResno(),v=s.getChainID();p!=r-1&&(0!=j.length&&p!=l&&(j+="-"+p),v=-1,l=r);t="/"+d.getModelNumberDotted(s.mi);0!=D&&v!=D&&(j+=":"+m+t);-1==v&&(j+=" "+r);p=r;D=s.getChainID();m=s.getChainIDStr();n+=q+s.getGroup3(!1);q="-"}}j+=(l==p?"":"-"+p)+(0==D?"":":"+
m)+t;h.put("groupNames",n);h.put("residueList",j.substring(1))}return a},"~O");r(c$,"getAtomData",function(a,c,e){a.startsWith("{")||(a="{"+a+"}");var b=c.toLowerCase().startsWith("user:"),d=c.toLowerCase().startsWith("property_");e&&(!b&&!d)&&(c=c.toUpperCase());b=d?"%{"+c+"}":b?c.substring(5):c.equals("xyzrn")?"%-2e %8.3x %8.3y %8.3z %4.2[vdw] 1 [%n]%r.%a#%i":c.equals("xyzvib")?"%-2e %10.5x %10.5y %10.5z %10.5vx %10.5vy %10.5vz":c.equals("pdb")?'{selected and not hetero}.label("ATOM  %5i %-4a%1A%3.3n %1c%4R%1E   %8.3x%8.3y%8.3z%6.2Q%6.2b          %2e  ").lines+{selected and hetero}.label("HETATM%5i %-4a%1A%3.3n %1c%4R%1E   %8.3x%8.3y%8.3z%6.2Q%6.2b          %2e  ").lines':
c.equals("xyz")?"%-2e %10.5x %10.5y %10.5z":c.equals("cfi")?"print 'from Jmol"+JV.Viewer.getJmolVersion()+"\n'+{selected}.count + ' ' + {selected}.bonds.count + '\n'   + {selected}.format('%10.0[atomno] %10.0[elemno] %10.4[xyz]')  + {selected}.bonds.format('%i1 %i2') + '\n' + {selected}.bonds.format('%ORDER')":null;if(null==b)return this.getModelExtract(this.vwr.getAtomBitSet(a),!1,!1,c.toUpperCase(),e);if(b.startsWith("print"))return this.vwr.runScript(b);0>b.indexOf("label")?b=a+'.label("'+b+'").lines':
a.equals("selected")||(b=JU.PT.rep(b,"selected",a.substring(1,a.length-1)));return this.vwr.evaluateExpression(b)},"~S,~S,~B");r(c$,"getModelExtract",function(a,c,e,b,d){if(b.equalsIgnoreCase("CML"))return this.getModelCml(a,2147483647,!0,c,d);if(b.equals("PDB")||b.equals("PQR"))return this.getPdbAtomData(a,null,b.equals("PQR"),c,d);var f=b.equalsIgnoreCase("V3000"),g=b.equalsIgnoreCase("SDF"),h=!c&&b.equalsIgnoreCase("XYZVIB"),n=b.equalsIgnoreCase("XYZRN"),q=b.toUpperCase().startsWith("XYZ"),k=b.equalsIgnoreCase("JSON")||
b.equalsIgnoreCase("CD");b=new JU.SB;var j=this.vwr.ms;if(!q&&!k){b.append(e?"Jmol Model Kit":this.vwr.fm.getFullPathName(!1).$replace("\\","/"));e=JV.Viewer.getJmolVersion();b.append("\n__Jmol-").append(e.substring(0,2));var m,l,t,p;p=new Date;e=p.getMonth();m=p.getDate();l=p.getFullYear();t=p.getHours();p=p.getMinutes();JU.PT.rightJustify(b,"_00",""+(1+e));JU.PT.rightJustify(b,"00",""+m);b.append((""+l).substring(2,4));JU.PT.rightJustify(b,"00",""+t);JU.PT.rightJustify(b,"00",""+p);b.append("3D 1   1.00000     0.00000     0");
b.append("\nJmol version ").append(JV.Viewer.getJmolVersion()).append(" EXTRACT: ").append(JU.Escape.eBS(a)).append("\n")}e=JU.BSUtil.copy(a);l=j.at;for(m=a.nextSetBit(0);0<=m;m=a.nextSetBit(m+1))c&&l[m].isDeleted()&&e.clear(m);p=JV.PropertyManager.getCovalentBondsForAtoms(j.bo,j.bondCount,e);if(!h&&0==e.cardinality())return"";a=!0;t=this.vwr.ms.getModelBS(e,!0);null!=j.trajectory&&!d&&j.trajectory.selectDisplayed(t);c=c?this.vwr.tm.getRotationQ():null;if(g){h=b.toString();b=new JU.SB;for(m=t.nextSetBit(0);0<=
m;m=t.nextSetBit(m+1)){b.append(h);f=JU.BSUtil.copy(e);f.and(j.getModelAtomBitSetIncludingDeleted(m,!1));p=JV.PropertyManager.getCovalentBondsForAtoms(j.bo,j.bondCount,f);if(!(a=this.addMolFile(m,b,f,p,!1,!1,c)))break;b.append("$$$$\n")}}else if(q){g=JM.LabelToken.compile(this.vwr,n?"%-2e _XYZ_ %4.2[vdw] 1 [%n]%r.%a#%i\n":"%-2e _XYZ_\n","\x00",null);n=h?JM.LabelToken.compile(this.vwr,"%-2e _XYZ_ %12.5vx %12.5vy %12.5vz\n","\x00",null):null;q=new JU.P3;for(m=t.nextSetBit(0);0<=m;m=t.nextSetBit(m+1))if(f=
JU.BSUtil.copy(e),f.and(j.getModelAtomBitSetIncludingDeleted(m,!1)),0!=f.cardinality()){b.appendI(f.cardinality()).appendC("\n");d=j.am[m].properties;b.append("Model["+(m+1)+"]: ");if(null!=j.frameTitles[m]&&0<j.frameTitles[m].length)b.append(j.frameTitles[m].$replace("\n"," "));else if(null==d)b.append("Jmol "+JV.Viewer.getJmolVersion());else{k=new JU.SB;p=d.propertyNames();for(var r=null;p.hasMoreElements();){var u=p.nextElement();u.equals(".PATH")?r=d.getProperty(u):k.append(";").append(u).append("=").append(d.getProperty(u))}null!=
r&&k.append(";PATH=").append(r);r=k.substring(0<k.length()?1:0);b.append(r.$replace("\n"," "))}b.appendC("\n");d=v(-1,[q]);for(k=f.nextSetBit(0);0<=k;k=f.nextSetBit(k+1))p=JM.LabelToken.formatLabelAtomArray(this.vwr,l[k],h&&null!=j.getVibration(k,!1)?n:g,"\x00",null,q),this.getPointTransf(m,j,l[k],c,q),p=JU.PT.rep(p,"_XYZ_",JU.PT.sprintf("%12.5p %12.5p %12.5p","p",d)),b.append(p)}}else a=this.addMolFile(-1,b,e,p,f,k,c);return a?b.toString():"ERROR: Too many atoms or bonds -- use V3000 format."},"JU.BS,~B,~B,~S,~B");
j(c$,"addMolFile",function(a,c,e,b,d,f,g){var h=e.cardinality(),n=b.cardinality();if(!d&&!f&&(999<h||999<n))return!1;var j=this.vwr.ms,k=O(j.ac,0),l=new JU.P3;d?c.append("  0  0  0  0  0  0            999 V3000"):f?c.append('{"mol":{"createdBy":"Jmol '+JV.Viewer.getJmolVersion()+'","a":['):(JU.PT.rightJustify(c,"   ",""+h),JU.PT.rightJustify(c,"   ",""+n),c.append("  0  0  0  0              1 V2000"));f||c.append("\n");d&&c.append("M  V30 BEGIN CTAB\nM  V30 COUNTS ").appendI(h).append(" ").appendI(n).append(" 0 0 0\n").append("M  V30 BEGIN ATOM\n");
for(var n=e.nextSetBit(0),m=0;0<=n;n=e.nextSetBit(n+1))this.getAtomRecordMOL(a,j,c,k[n]=++m,j.at[n],g,l,d,f);d?c.append("M  V30 END ATOM\nM  V30 BEGIN BOND\n"):f&&c.append('],"b":[');n=b.nextSetBit(0);for(m=0;0<=n;n=b.nextSetBit(n+1))this.getBondRecordMOL(c,++m,j.bo[n],k,d,f);d&&c.append("M  V30 END BOND\nM  V30 END CTAB\n");f?c.append("]}}"):c.append("M  END\n");if(!f&&!d&&(a=j.getPartialCharges(),null!=a)){c.append("> <JMOL_PARTIAL_CHARGES>\n").appendI(h).appendC("\n");n=e.nextSetBit(0);for(m=0;0<=
n;n=e.nextSetBit(n+1))c.appendI(++m).append(" ").appendF(a[n]).appendC("\n")}return!0},"~N,JU.SB,JU.BS,JU.BS,~B,~B,JU.Quat");c$.getCovalentBondsForAtoms=j(c$,"getCovalentBondsForAtoms",function(a,c,e){for(var b=new JU.BS,d=0;d<c;d++){var f=a[d];e.get(f.atom1.i)&&(e.get(f.atom2.i)&&f.isCovalent())&&b.set(d)}return b},"~A,~N,JU.BS");j(c$,"getAtomRecordMOL",function(a,c,e,b,d,f,g,h,n){this.getPointTransf(a,c,d,f,g);a=d.getElementNumber();c=d.isDeleted()?"Xx":JU.Elements.elementSymbolFromNumber(a);f=
d.getIsotopeNumber();var j=d.getFormalCharge();g=v(-1,[g]);h?(e.append("M  V30 ").appendI(b).append(" ").append(c).append(JU.PT.sprintf(" %12.5p %12.5p %12.5p 0","p",g)),0!=j&&e.append(" CHG=").appendI(j),0!=f&&e.append(" MASS=").appendI(f),e.append("\n")):n?(1!=b&&e.append(","),e.append("{"),6!=d.getElementNumber()&&e.append('"l":"').append(d.getElementSymbol()).append('",'),0!=j&&e.append('"c":').appendI(j).append(","),0!=f&&f!=JU.Elements.getNaturalIsotope(a)&&e.append('"m":').appendI(f).append(","),
e.append('"x":').appendF(d.x).append(',"y":').appendF(d.y).append(',"z":').appendF(d.z).append("}")):(e.append(JU.PT.sprintf("%10.5p%10.5p%10.5p","p",g)),e.append(" ").append(c),1==c.length&&e.append(" "),0<f&&(f-=JU.Elements.getNaturalIsotope(d.getElementNumber())),e.append(" "),JU.PT.rightJustify(e,"  ",""+f),JU.PT.rightJustify(e,"   ",""+(0==j?0:4-j)),e.append("  0  0  0  0\n"))},"~N,JM.ModelSet,JU.SB,~N,JM.Atom,JU.Quat,JU.P3,~B,~B");j(c$,"getPointTransf",function(a,c,e,b,d){c.isTrajectory(0<=
a?a:e.mi)?c.trajectory.getFractional(e,d):d.setT(e);null!=b&&b.transform2(d,d)},"~N,JM.ModelSet,JM.Atom,JU.Quat,JU.P3");j(c$,"getBondRecordMOL",function(a,c,e,b,d,f){var g=b[e.atom1.i];b=b[e.atom2.i];var h=e.getValence();3<h&&(h=1);switch(e.order&-131073){case 515:h=f?-3:4;break;case 66:h=f?-3:5;break;case 513:h=f?1:6;break;case 514:h=f?2:7;break;case 33:h=f?-1:8}d?a.append("M  V30 ").appendI(c).append(" ").appendI(h).append(" ").appendI(g).append(" ").appendI(b).appendC("\n"):f?(1!=c&&a.append(","),
a.append('{"b":').appendI(g-1).append(',"e":').appendI(b-1),1!=h&&(a.append(',"o":'),0>h?a.appendF(-h/2):a.appendI(h)),a.append("}")):(JU.PT.rightJustify(a,"   ",""+g),JU.PT.rightJustify(a,"   ",""+b),a.append("  ").appendI(h).append("  0  0  0\n"))},"JU.SB,~N,JM.Bond,~A,~B,~B");r(c$,"getChimeInfo",function(a,c){switch(a){case 1073741982:break;case 1073741864:return this.getBasePairInfo(c);default:return this.getChimeInfoA(this.vwr.ms.at,a,c)}var e=new JU.SB;this.vwr.getChimeMessenger().getAllChimeInfo(e);
return e.appendC("\n").toString().substring(1)},"~N,JU.BS");j(c$,"getChimeInfoA",function(a,c,e){var b=new JU.SB;b.append("\n");var d="",f=null,g=null,h=-1,j=0;if(null!=e)for(var q=e.nextSetBit(0);0<=q;q=e.nextSetBit(q+1)){var k=a[q];switch(c){default:return"";case 1114638363:d=k.getInfo();break;case 1141899265:d=""+k.getAtomNumber();break;case 1087373318:d=k.getGroup3(!1);break;case 1087373316:case 1073742120:case 1087373320:case 1087373319:var l=k.getChainID(),d=0==l?" ":k.getChainIDStr();300<=
l&&(d=JU.PT.esc(d));switch(c){case 1073742120:d="["+k.getGroup3(!1)+"]"+k.group.getSeqcodeString()+":"+d;break;case 1087373320:case 1087373319:k.mi!=h&&(b.appendC("\n"),j=0,h=k.mi,b.append("Model "+k.getModelNumber()),f=g=null);k.group.chain!==f&&(b.appendC("\n"),j=0,f=k.group.chain,b.append("Chain "+d+":\n"),g=null);d=k.group;d!==g&&(g=d,1087373319==c?b.append(k.getGroup1("?")):(0==j++%5&&1<j&&b.appendC("\n"),JU.PT.leftJustify(b,"          ","["+k.getGroup3(!1)+"]"+k.getResno()+" ")));continue}}0>
b.indexOf("\n"+d+"\n")&&b.append(d).appendC("\n")}1087373320==c&&b.appendC("\n");return b.toString().substring(1)},"~A,~N,JU.BS");r(c$,"getModelFileInfo",function(a){for(var c=this.vwr.ms,e=new JU.SB,b=0;b<c.mc;++b)if(null==a||a.get(b)){var d='["'+c.getModelNumberDotted(b)+'"] = ';e.append("\n\nfile").append(d).append(JU.PT.esc(c.getModelFileName(b)));var f=c.getInfo(b,"modelID");null!=f&&e.append("\nid").append(d).append(JU.PT.esc(f));e.append("\ntitle").append(d).append(JU.PT.esc(c.getModelTitle(b)));
e.append("\nname").append(d).append(JU.PT.esc(c.getModelName(b)));e.append("\ntype").append(d).append(JU.PT.esc(c.getModelFileType(b)))}return e.toString()},"JU.BS");j(c$,"getAllAtomInfo",function(a){for(var c=new JU.Lst,e=new JU.P3,b=a.nextSetBit(0);0<=b;b=a.nextSetBit(b+1))c.addLast(this.getAtomInfoLong(b,e));return c},"JU.BS");j(c$,"getAtomInfoLong",function(a,c){var e=this.vwr.ms,b=e.at[a],d=new java.util.Hashtable;e.getAtomIdentityInfo(a,d,c);d.put("element",e.getElementName(a));d.put("elemno",
Integer.$valueOf(e.at[a].getElementNumber()));d.put("x",Float.$valueOf(b.x));d.put("y",Float.$valueOf(b.y));d.put("z",Float.$valueOf(b.z));d.put("coord",JU.P3.newP(b));null!=e.vibrations&&null!=e.vibrations[a]&&e.vibrations[a].getInfo(d);d.put("bondCount",Integer.$valueOf(b.getCovalentBondCount()));d.put("radius",Float.$valueOf(b.getRasMolRadius()/120));d.put("model",b.getModelNumberForLabel());var f=b.atomPropertyString(this.vwr,1087373324);null!=f&&d.put("shape",f);d.put("visible",Boolean.$valueOf(b.checkVisible()));
d.put("clickabilityFlags",Integer.$valueOf(b.clickabilityFlags));d.put("visibilityFlags",Integer.$valueOf(b.shapeVisibilityFlags));d.put("spacefill",Float.$valueOf(b.getRadius()));f=JU.Escape.escapeColor(this.vwr.gdata.getColorArgbOrGray(b.colixAtom));null!=f&&d.put("color",f);d.put("colix",Integer.$valueOf(b.colixAtom));(f=JU.C.isColixTranslucent(b.colixAtom))&&d.put("translucent",Boolean.$valueOf(f));d.put("formalCharge",Integer.$valueOf(b.getFormalCharge()));d.put("partialCharge",Float.$valueOf(b.getPartialCharge()));
f=b.getSurfaceDistance100()/100;0<=f&&d.put("surfaceDistance",Float.$valueOf(f));if(e.am[b.mi].isBioModel){d.put("resname",b.getGroup3(!1));var f=b.group.getInsertionCode(),g=b.getResno();0<g&&d.put("resno",Integer.$valueOf(g));0!=f.charCodeAt(0)&&d.put("insertionCode",""+f);d.put("name",e.at[a].getAtomName());d.put("chain",b.getChainIDStr());d.put("atomID",Integer.$valueOf(b.atomID));d.put("groupID",Integer.$valueOf(b.group.groupID));"\x00"!=b.altloc&&d.put("altLocation",""+b.altloc);d.put("structure",
Integer.$valueOf(b.group.getProteinStructureType().getId()));d.put("polymerLength",Integer.$valueOf(b.group.getBioPolymerLength()));d.put("occupancy",Integer.$valueOf(b.getOccupancy100()));e=b.getBfactor100();d.put("temp",Integer.$valueOf(I(e/100)))}return d},"~N,JU.P3");j(c$,"getAllBondInfo",function(a){var c=new JU.Lst,e=this.vwr.ms,b=e.bondCount,e=e.bo,d;l(a,String)&&(a=this.vwr.getAtomBitSet(a));var f=new JU.P3;if(l(a,Array)){d=a[0];var g=a[1];for(a=0;a<b;a++){var h=e[a].atom1.i,j=e[a].atom2.i;
(d.get(h)&&g.get(j)||g.get(h)&&d.get(j))&&c.addLast(this.getBondInfo(a,f))}}else if(l(a,JM.BondSet)){d=a;for(a=d.nextSetBit(0);0<=a&&a<b;a=d.nextSetBit(a+1))c.addLast(this.getBondInfo(a,f))}else if(l(a,JU.BS)){d=a;g=1==d.cardinality()?d.nextSetBit(0):-1;for(a=0;a<b;a++)(0<=g?e[a].atom1.i==g||e[a].atom2.i==g:d.get(e[a].atom1.i)&&d.get(e[a].atom2.i))&&c.addLast(this.getBondInfo(a,f))}return c},"~O");j(c$,"getBondInfo",function(a,c){var e=this.vwr.ms.bo[a],b=e.atom1,d=e.atom2,f=new java.util.Hashtable;
f.put("_bpt",Integer.$valueOf(a));var g=new java.util.Hashtable;this.vwr.ms.getAtomIdentityInfo(b.i,g,c);var h=new java.util.Hashtable;this.vwr.ms.getAtomIdentityInfo(d.i,h,c);f.put("atom1",g);f.put("atom2",h);f.put("order",Float.$valueOf(JU.PT.fVal(JU.Edge.getBondOrderNumberFromOrder(e.order))));f.put("type",JU.Edge.getBondOrderNameFromOrder(e.order));f.put("radius",Float.$valueOf(e.mad/2E3));f.put("length_Ang",Float.$valueOf(b.distance(d)));f.put("visible",Boolean.$valueOf(0!=e.shapeVisibilityFlags));
b=JU.Escape.escapeColor(this.vwr.gdata.getColorArgbOrGray(e.colix));null!=b&&f.put("color",b);f.put("colix",Integer.$valueOf(e.colix));JU.C.isColixTranslucent(e.colix)&&f.put("translucent",Boolean.TRUE);return f},"~N,JU.P3");j(c$,"getAllChainInfo",function(a){for(var c=new java.util.Hashtable,e=new JU.Lst,b=this.vwr.ms.mc,d=0;d<b;++d){var f=new java.util.Hashtable,g=this.getChainInfo(d,a);0<g.size()&&(f.put("modelIndex",Integer.$valueOf(d)),f.put("chains",g),e.addLast(f))}c.put("models",e);return c},
"JU.BS");j(c$,"getChainInfo",function(a,c){for(var e=this.vwr.ms.am[a],b=e.getChainCount(!0),d=new JU.Lst,f=new JU.P3,g=0;g<b;g++){for(var h=e.getChainAt(g),j=new JU.Lst,q=h.groupCount,k=new java.util.Hashtable,l=0;l<q;l++){var m=h.groups[l];c.get(m.firstAtomIndex)&&j.addLast(m.getGroupInfo(l,f))}j.isEmpty()||(k.put("residues",j),d.addLast(k))}return d},"~N,JU.BS");j(c$,"getAllPolymerInfo",function(a){var c=new java.util.Hashtable;null!=this.vwr.ms.bioModelset&&this.vwr.ms.bioModelset.getAllPolymerInfo(a,
c);return c},"JU.BS");j(c$,"getBasePairInfo",function(a){var c=new JU.SB,e=new JU.Lst;this.vwr.ms.calcRasmolHydrogenBonds(a,a,e,!0,1,!1,null);for(a=e.size();0<=--a;){var b=e.get(a);JV.PropertyManager.getAtomResidueInfo(c,b.atom1);c.append(" - ");JV.PropertyManager.getAtomResidueInfo(c,b.atom2);c.append("\n")}return c.toString()},"JU.BS");c$.getAtomResidueInfo=j(c$,"getAtomResidueInfo",function(a,c){a.append("[").append(c.getGroup3(!1)).append("]").append(c.group.getSeqcodeString()).append(":");var e=
c.getChainID();a.append(0==e?" ":c.getChainIDStr())},"JU.SB,JM.Atom");j(c$,"getAppletInfo",function(){var a=new java.util.Hashtable;a.put("htmlName",this.vwr.htmlName);a.put("syncId",this.vwr.syncId);a.put("fullName",this.vwr.fullName);a.put("codeBase",""+JV.Viewer.appletCodeBase);this.vwr.isApplet&&(a.put("documentBase",JV.Viewer.appletDocumentBase),a.put("registry",this.vwr.sm.getRegistryInfo()));a.put("version",JV.JC.version);a.put("date",JV.JC.date);a.put("javaVendor",JV.Viewer.strJavaVendor);
a.put("javaVersion",JV.Viewer.strJavaVersion+(!this.vwr.isJS?"":this.vwr.isWebGL?"(WebGL)":"(HTML5)"));a.put("operatingSystem",JV.Viewer.strOSName);return a});j(c$,"getAnimationInfo",function(){var a=this.vwr.am,c=new java.util.Hashtable;c.put("firstModelIndex",Integer.$valueOf(a.firstFrameIndex));c.put("lastModelIndex",Integer.$valueOf(a.lastFrameIndex));c.put("animationDirection",Integer.$valueOf(a.animationDirection));c.put("currentDirection",Integer.$valueOf(a.currentDirection));c.put("displayModelIndex",
Integer.$valueOf(a.cmi));null!=a.animationFrames&&(c.put("isMovie",Boolean.TRUE),c.put("frames",JU.Escape.eAI(a.animationFrames)),c.put("currentAnimationFrame",Integer.$valueOf(a.caf)));c.put("displayModelNumber",this.vwr.getModelNumberDotted(a.cmi));c.put("displayModelName",0<=a.cmi?this.vwr.getModelName(a.cmi):"");c.put("animationFps",Integer.$valueOf(a.animationFps));c.put("animationReplayMode",JS.T.nameOf(a.animationReplayMode));c.put("firstFrameDelay",Float.$valueOf(a.firstFrameDelay));c.put("lastFrameDelay",
Float.$valueOf(a.lastFrameDelay));c.put("animationOn",Boolean.$valueOf(a.animationOn));c.put("animationPaused",Boolean.$valueOf(a.animationPaused));return c});j(c$,"getBoundBoxInfo",function(){var a=this.vwr.ms.getBoxInfo(null,1).getBoundBoxPoints(!0),c=new java.util.Hashtable;c.put("center",JU.P3.newP(a[0]));c.put("vector",JU.V3.newV(a[1]));c.put("corner0",JU.P3.newP(a[2]));c.put("corner1",JU.P3.newP(a[3]));return c});j(c$,"getShapeInfo",function(){var a=new java.util.Hashtable,c=new JU.SB,e=this.vwr.shm.shapes;
if(null!=e)for(var b=0;37>b;++b){var d=e[b];if(null!=d){var f=JV.JC.shapeClassBases[b],d=d.getShapeDetail();null!=d&&a.put(f,d)}}0<c.length()&&a.put("shapeCommands",c.toString());return a});j(c$,"getAnnotationInfo",function(a,c){var e=this.vwr.getAtomBitSet(a),e=this.vwr.ms.getModelBS(e,!1).nextSetBit(0);if(0>e)return null;var b=this.vwr.ms.getModelAuxiliaryInfo(e).get(1073741925==c?"domains":"validation");if(null==b||6!=b.tok)return null;this.vwr.getAnnotationParser().initializeAnnotation(b,c,e);
return b.mapGet("_list")},"~O,~N");j(c$,"getMeasurementInfo",function(){return this.vwr.getShapeProperty(6,"info")});j(c$,"getMouseInfo",function(){if(!this.vwr.haveDisplay)return null;for(var a=new java.util.Hashtable,c=new JU.Lst,e=this.vwr.acm,b,d=e.b.getBindings().values().iterator();d.hasNext()&&((b=d.next())||1);)l(b,Boolean)||(JU.AU.isAI(b)&&(b=v(-1,[JV.binding.Binding.getMouseActionName(b[0],!1),JV.ActionManager.getActionName(b[1])])),c.addLast(b));a.put("bindings",c);a.put("bindingName",
e.b.name);a.put("actionNames",JV.ActionManager.actionNames);a.put("actionInfo",JV.ActionManager.actionInfo);a.put("bindingInfo",JU.PT.split(e.getBindingInfo(null),"\n"));return a});r(c$,"getPdbAtomData",function(a,c,e,b){if(0==this.vwr.ms.ac||0>a.nextSetBit(0))return"";null==c?c=this.vwr.getOutputChannel(null,null):(e=(new Boolean(e|0<=c.getType().indexOf("PQR"))).valueOf(),b=(new Boolean(b|0<=c.getType().indexOf("-coord true"))).valueOf());var d=this.vwr.ms.at,f=this.vwr.ms.am,g=d[a.nextSetBit(0)].mi,
h=-1,j=!1,q="%6.2Q%6.2b          ";if(e){var q="%8.4P%7.4V       ",k=0;for(e=a.nextSetBit(0);0<=e;e=a.nextSetBit(e+1))k+=d[e].getPartialCharge();c.append("REMARK   1 PQR file generated by Jmol "+JV.Viewer.getJmolVersion()).append("\nREMARK   1 created "+new java.util.Date).append("\nREMARK   1 Forcefield Used: unknown\nREMARK   1").append("\nREMARK   5").append("\nREMARK   6 Total charge on this protein: "+k+" e\nREMARK   6\n")}e=a.length()-1;var l=g!=d[e].mi,m=new JU.Lst,g=f[g].isPdbWithMultipleBonds,
r,t=new JU.P3,p=v(-1,[t]),w=b?this.vwr.tm.getRotationQ():null;for(e=a.nextSetBit(0);0<=e;e=a.nextSetBit(e+1))b=d[e],j=f[b.mi].isBioModel,l&&b.mi!=h&&(-1!=h&&c.append("ENDMDL\n"),h=b.mi,c.append("MODEL     "+(h+1)+"\n"),m=new JU.Lst),k=b.getAtomName(),r=2==b.getElementSymbol().length||4<=k.length||JU.PT.isDigit(k.charAt(0)),k=b.isHetero(),r=j?k?r?JM.LabelToken.compile(this.vwr,"HETATM%5.-5i %-4.4a%1A%3.3n %1c%4.-4R%1E   _XYZ_"+q,"\x00",null):JM.LabelToken.compile(this.vwr,"HETATM%5.-5i  %-3.3a%1A%3.3n %1c%4.-4R%1E   _XYZ_"+
q,"\x00",null):r?JM.LabelToken.compile(this.vwr,"ATOM  %5.-5i %-4.4a%1A%3.3n %1c%4.-4R%1E   _XYZ_"+q,"\x00",null):JM.LabelToken.compile(this.vwr,"ATOM  %5.-5i  %-3.3a%1A%3.3n %1c%4.-4R%1E   _XYZ_"+q,"\x00",null):r?JM.LabelToken.compile(this.vwr,"HETATM%5.-5i %-4.4a%1AUNK %1c   1%1E   _XYZ_"+q,"\x00",null):JM.LabelToken.compile(this.vwr,"HETATM%5.-5i  %-3.3a%1AUNK %1c   1%1E   _XYZ_"+q,"\x00",null),k=b.getElementSymbolIso(!1).toUpperCase(),k=this.pdbKey(b.group.getBioPolymerIndexInModel())+this.pdbKey(b.group.groupIndex)+
JM.LabelToken.formatLabelAtomArray(this.vwr,b,r,"\x00",null,t)+(1==k.length?" "+k:k.substring(0,2))+"  ",this.getPointTransf(-1,this.vwr.ms,b,w,t),b=JU.PT.sprintf("%8.3p%8.3p%8.3p","p",p),24<b.length&&(b=JU.PT.sprintf("%8.2p%8.2p%8.2p","p",p)),k=JU.PT.rep(k,"_XYZ_",b),m.addLast(k);f=new java.util.Hashtable;this.fixPDBFormat(m,f,c);if(l)c.append("ENDMDL\n");else for(e=a.nextSetBit(0);0<=e;e=a.nextSetBit(e+1))if(b=d[e],k=!j||b.isHetero(),h=!k&&16==b.getElementNumber(),k||g||h)if(q=b.bonds,null!=q)for(l=
0;l<q.length;l++)if(t=b.getAtomNumber(),p=q[l].getOtherAtom(b),a.get(p.i)&&(m=q[l].getCovalentOrder(),!(1==m&&(g&&!k&&!h||h&&16!=p.getElementNumber()))))switch(p=p.getAtomNumber(),m){case 2:case 3:if(p<t)continue;case 1:c.append("CONECT").append(JU.PT.formatStringS("%5s","s",""+f.get(Integer.$valueOf(t))));t=JU.PT.formatStringS("%5s","s",""+f.get(Integer.$valueOf(p)));for(p=0;p<m;p++)c.append(t);c.append("\n")}return c.toString()},"JU.BS,JU.OC,~B,~B,~B");j(c$,"pdbKey",function(a){a=0>a?"!999":"   "+
a;return a.substring(a.length-4)},"~N");j(c$,"fixPDBFormat",function(a,c,e){a.addLast("!999!999XXXXXX99999999999999999999!99!");var b=Array(a.size());a.toArray(b);java.util.Arrays.sort(b);a.clear();for(var d=0,f=b.length;d<f;d++)a.addLast(b[d]);for(var g=b=null,f=a.size(),d=0;d<f;d++){var h=a.get(d),j=h.substring(0,4),h=h.substring(8),l=!1,k=0<=h.indexOf("!99!");if(!j.equals(b)||k)null!=b&&!b.equals("!999")&&(l=!0,h="TER   "+g.substring(6,11)+"      "+g.substring(17,27),a.add(d,j+"!!!!"+h),f++),b=
j;if(k&&!l)break;g=h;null!=c&&!l&&c.put(Integer.$valueOf(JU.PT.parseInt(h.substring(6,11))),Integer.$valueOf(d+1));j="     "+(d+1);e.append(h.substring(0,6)).append(j.substring(j.length-5)).append(h.substring(11)).append("\n")}},"JU.Lst,java.util.Map,JU.OC");r(c$,"getPdbData",function(a,c,e,b,d,f){this.vwr.ms.isJmolDataFrameForModel(a)&&(a=this.vwr.ms.getJmolDataSourceFrame(a));if(0>a)return"";var g=this.vwr.ms.am[a],h=g.isBioModel;if(null==b&&!h)return null;null==d&&(d=this.vwr.getOutputChannel(null,
null));var j=new JU.SB,l=0<=c.indexOf("draw"),k=null,r=new JU.BS,m="\x00",C=this.vwr.ms.getLabeler().compile(this.vwr,"ATOM  %-6i%4a%1A%3.-3n %1c%4R%1E   ","\x00",null);if(null==b)m=11<c.length&&0<=c.indexOf("quaternion ")?c.charAt(11):"R",g.getPdbData(c,m,l,e,d,C,j,r),k=this.vwr.getModelUndeletedAtomsBitSet(a);else{k=b[0];a=b[1];var g=b[2],t=b[3],p=null!=g,E=null!=t,u=b[4],s=b[5],y=b[6],B=b[7],z=b[8],A=b[9];b=null!=y&&null==z;var F=this.vwr.ms.at;if(b){d.append("REMARK   6 Jmol PDB-encoded data: ").append(c).append("; ").append(JV.Viewer.getJmolVersion()).append("; ").append(this.vwr.apiPlatform.getDateFormat(null)).append("\n");
d.append("REMARK   6 Jmol data").append(" min = ").append(JU.Escape.eP(u)).append(" max = ").append(JU.Escape.eP(s)).append(" unScaledXyz = xyz * ").append(JU.Escape.eP(y)).append(" + ").append(JU.Escape.eP(B)).append(";\n");s=null;for(c=k.nextSetBit(0);0<=c;c=k.nextSetBit(c+1))if(u=""+F[c].getAtomName(),null!=s||4<u.length)null==s?(s="",c=-1):s+=" "+u;null!=s&&d.append("REMARK   6 Jmol atom names").append(s).append("\n");s=null;for(c=k.nextSetBit(0);0<=c;c=k.nextSetBit(c+1))if(u=""+F[c].getGroup3(!0),
null!=s||3<u.length)null==s?(s="",c=-1):s+=" "+u;null!=s&&d.append("REMARK   6 Jmol residue names").append(s).append("\n");for(c=0;c<A.length;c++)null!=A[c]&&d.append("REMARK   6 Jmol property ").append(A[c]).append(";\n")}A=null;u=new JU.P3;b||(null==z&&(z="%-5i %-10s %-13.5f "+(E?"%-13.5f %-13.5f":p?"%-13.5f":"")),z+="\n");c=k.nextSetBit(0);for(s=0;0<=c;c=k.nextSetBit(c+1),s++){var y=a[s],B=p?g[s]:0,G=E?t[s]:0;if(!Float.isNaN(y)&&!Float.isNaN(B)&&!Float.isNaN(G)){var x=F[c];b?(d.append(JM.LabelToken.formatLabelAtomArray(this.vwr,
x,C,"\x00",null,u)),h&&r.set(c),d.append(JU.PT.sprintf("%-8.2f%-8.2f%-10.2f    %6.3f          %2s    %s\n","ssF",v(-1,[x.getElementSymbolIso(!1).toUpperCase(),"",w(-1,[y,B,G,0])]))),null!=A&&A.group.getBioPolymerIndexInModel()==x.group.getBioPolymerIndexInModel()&&j.append("CONECT").append(JU.PT.formatStringI("%5i","i",A.getAtomNumber())).append(JU.PT.formatStringI("%5i","i",x.getAtomNumber())).appendC("\n")):E?d.append(JU.PT.sprintf(z,"isF",v(-1,[Integer.$valueOf(x.getAtomNumber()),x.getAtomName(),
w(-1,[y,B,G])]))):p?d.append(JU.PT.sprintf(z,"isF",v(-1,[Integer.$valueOf(x.getAtomNumber()),x.getAtomName(),w(-1,[y,B])]))):d.append(JU.PT.sprintf(z,"isF",v(-1,[Integer.$valueOf(x.getAtomNumber()),x.getAtomName(),w(-1,[y])])));A=x}}}d.append(j.toString());if(l)return d.toString();e.and(k);h&&f&&d.append("\n\n"+this.vwr.ms.getProteinStructureState(r,"R"==m?1052714:1074790662));return d.toString()},"~N,~S,JU.BS,~A,JU.OC,~B");r(c$,"getModelCml",function(a,c,e){var b=new JU.SB;if(0==JU.BSUtil.cardinalityOf(a))return"";
J.api.Interface.getInterface("JU.XmlUtil",this.vwr,"file");JU.XmlUtil.openTag(b,"molecule");JU.XmlUtil.openTag(b,"atomArray");for(var d=new JU.BS,f=this.vwr.ms.at,g=a.nextSetBit(0);0<=g&&!(0>--c);g=a.nextSetBit(g+1)){var h=f[g],j=h.getAtomName();JU.PT.rep(j,'"',"''");d.set(h.i);JU.XmlUtil.appendTag(b,"atom/",v(-1,["id","a"+(h.i+1),"title",h.getAtomName(),"elementType",h.getElementSymbol(),"x3",""+h.x,"y3",""+h.y,"z3",""+h.z]))}JU.XmlUtil.closeTag(b,"atomArray");if(e){JU.XmlUtil.openTag(b,"bondArray");
a=this.vwr.ms.bondCount;c=this.vwr.ms.bo;for(g=0;g<a;g++)e=c[g],f=e.atom2,d.get(e.atom1.i)&&d.get(f.i)&&(f=JU.Edge.getCmlBondOrder(e.order),null!=f&&JU.XmlUtil.appendTag(b,"bond/",v(-1,["atomRefs2","a"+(e.atom1.i+1)+" a"+(e.atom2.i+1),"order",f])));JU.XmlUtil.closeTag(b,"bondArray")}JU.XmlUtil.closeTag(b,"molecule");return b.toString()},"JU.BS,~N,~B,~B,~B");H(c$,"atomExpression","<atom selection>");c$.propertyTypes=c$.prototype.propertyTypes=v(-1,"appletInfo;;;fileName;;;fileHeader;;;fileContents;<pathname>;;fileContents;;;animationInfo;;;modelInfo;<atom selection>;{*};ligandInfo;<atom selection>;{*};shapeInfo;;;measurementInfo;;;centerInfo;;;orientationInfo;;;transformInfo;;;atomList;<atom selection>;(visible);atomInfo;<atom selection>;(visible);bondInfo;<atom selection>;(visible);chainInfo;<atom selection>;(visible);polymerInfo;<atom selection>;(visible);moleculeInfo;<atom selection>;(visible);stateInfo;<state type>;all;extractModel;<atom selection>;(visible);jmolStatus;statusNameList;;jmolViewer;;;messageQueue;;;auxiliaryInfo;<atom selection>;{*};boundBoxInfo;;;dataInfo;<data type>;types;image;<width=www,height=hhh>;;evaluate;<expression>;;menu;<type>;current;minimizationInfo;;;pointGroupInfo;<atom selection>;(visible);fileInfo;<type>;;errorMessage;;;mouseInfo;;;isosurfaceInfo;;;isosurfaceData;;;consoleText;;;JSpecView;<key>;;scriptQueueInfo;;;nmrInfo;<elementSymbol> or 'all' or 'shifts';all;variableInfo;<name>;all;domainInfo;<atom selection>;{visible};validationInfo;<atom selection>;{visible};service;<hashTable>;".split(";"));
H(c$,"PROP_APPLET_INFO",0,"PROP_FILENAME",1,"PROP_FILEHEADER",2,"PROP_FILECONTENTS_PATH",3,"PROP_FILECONTENTS",4,"PROP_ANIMATION_INFO",5,"PROP_MODEL_INFO",6,"PROP_LIGAND_INFO",7,"PROP_SHAPE_INFO",8,"PROP_MEASUREMENT_INFO",9,"PROP_CENTER_INFO",10,"PROP_ORIENTATION_INFO",11,"PROP_TRANSFORM_INFO",12,"PROP_ATOM_LIST",13,"PROP_ATOM_INFO",14,"PROP_BOND_INFO",15,"PROP_CHAIN_INFO",16,"PROP_POLYMER_INFO",17,"PROP_MOLECULE_INFO",18,"PROP_STATE_INFO",19,"PROP_EXTRACT_MODEL",20,"PROP_JMOL_STATUS",21,"PROP_JMOL_VIEWER",
22,"PROP_MESSAGE_QUEUE",23,"PROP_AUXILIARY_INFO",24,"PROP_BOUNDBOX_INFO",25,"PROP_DATA_INFO",26,"PROP_IMAGE",27,"PROP_EVALUATE",28,"PROP_MENU",29,"PROP_MINIMIZATION_INFO",30,"PROP_POINTGROUP_INFO",31,"PROP_FILE_INFO",32,"PROP_ERROR_MESSAGE",33,"PROP_MOUSE_INFO",34,"PROP_ISOSURFACE_INFO",35,"PROP_ISOSURFACE_DATA",36,"PROP_CONSOLE_TEXT",37,"PROP_JSPECVIEW",38,"PROP_SCRIPT_QUEUE_INFO",39,"PROP_NMR_INFO",40,"PROP_VAR_INFO",41,"PROP_DOM_INFO",42,"PROP_VAL_INFO",43,"PROP_SERVICE",44,"PROP_COUNT",45,"readableTypes",
v(-1," stateinfo extractmodel filecontents fileheader image menu minimizationInfo".split(" ")))})})(Clazz,Clazz.newLongArray,Clazz.doubleToByte,Clazz.doubleToInt,Clazz.doubleToLong,Clazz.declarePackage,Clazz.instanceOf,Clazz.load,Clazz.instantialize,Clazz.decorateAsClass,Clazz.floatToInt,Clazz.floatToLong,Clazz.makeConstructor,Clazz.defineEnumConstant,Clazz.exceptionOf,Clazz.newIntArray,Clazz.defineStatics,Clazz.newFloatArray,Clazz.declareType,Clazz.prepareFields,Clazz.superConstructor,Clazz.newByteArray,
Clazz.declareInterface,Clazz.p0p,Clazz.pu$h,Clazz.newShortArray,Clazz.innerTypeInstance,Clazz.isClassDefined,Clazz.prepareCallback,Clazz.newArray,Clazz.castNullAs,Clazz.floatToShort,Clazz.superCall,Clazz.decorateAsType,Clazz.newBooleanArray,Clazz.newCharArray,Clazz.implementOf,Clazz.newDoubleArray,Clazz.overrideConstructor,Clazz.clone,Clazz.doubleToShort,Clazz.getInheritedLevel,Clazz.getParamsType,Clazz.isAF,Clazz.isAI,Clazz.isAS,Clazz.isASS,Clazz.isAP,Clazz.isAFloat,Clazz.isAII,Clazz.isAFF,Clazz.isAFFF,
Clazz.tryToSearchAndExecute,Clazz.getStackTrace,Clazz.inheritArgs,Clazz.alert,Clazz.defineMethod,Clazz.overrideMethod,Clazz.declareAnonymous,Clazz.cloneFinals);
